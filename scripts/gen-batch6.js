import { writeFileSync, mkdirSync } from 'node:fs';

const SKILLS = [
  { slug:'ssh-client', displayName:'SSH Client', cat:'DevOps', icon:'terminal', desc:'Execute remote commands and manage files via SSH.', tags:['ssh','remote','devops','terminal'], actions:[
    {name:'exec_command',method:'POST',path:'/exec',params:[{n:'host',req:true,t:'string'},{n:'command',req:true,t:'string'},{n:'username',req:false,t:'string'}],response:{stdout:'output',exitCode:0}},
    {name:'upload_file',method:'POST',path:'/upload',params:[{n:'host',req:true,t:'string'},{n:'localPath',req:true,t:'string'},{n:'remotePath',req:true,t:'string'}],response:{status:'uploaded',bytes:1024}},
    {name:'download_file',method:'POST',path:'/download',params:[{n:'host',req:true,t:'string'},{n:'remotePath',req:true,t:'string'},{n:'localPath',req:true,t:'string'}],response:{status:'downloaded',bytes:2048}},
    {name:'list_dir',method:'POST',path:'/ls',params:[{n:'host',req:true,t:'string'},{n:'path',req:false,t:'string',def:'/'}],response:{files:[{name:'file.txt',size:100,type:'file'}]}},
  ]},
  { slug:'code-sandbox-e2b', displayName:'Code Sandbox (E2B)', cat:'DevOps', icon:'box', desc:'Run code in isolated sandboxes via E2B platform.', tags:['sandbox','e2b','code','execution'], actions:[
    {name:'create_sandbox',method:'POST',path:'/sandboxes',params:[{n:'template',req:false,t:'string',def:'base'}],response:{sandboxId:'sb1',status:'running'}},
    {name:'exec_code',method:'POST',pathTemplate:'/sandboxes/{sandboxId}/execute',params:[{n:'sandboxId',req:true,t:'string'},{n:'code',req:true,t:'string'},{n:'language',req:false,t:'string',def:'python'}],response:{stdout:'Hello',stderr:'',exitCode:0}},
    {name:'upload_file',method:'POST',pathTemplate:'/sandboxes/{sandboxId}/files',params:[{n:'sandboxId',req:true,t:'string'},{n:'path',req:true,t:'string'},{n:'content',req:true,t:'string'}],response:{path:'/home/user/file.py'}},
    {name:'close_sandbox',method:'DELETE',pathTemplate:'/sandboxes/{sandboxId}',params:[{n:'sandboxId',req:true,t:'string'}],response:{status:'closed'}},
  ]},
  { slug:'ollama-local-llm', displayName:'Ollama Local LLM', cat:'AI', icon:'cpu', desc:'Run local LLM inference via Ollama API.', tags:['ollama','llm','local','ai'], actions:[
    {name:'generate',method:'POST',path:'/api/generate',params:[{n:'model',req:true,t:'string'},{n:'prompt',req:true,t:'string'},{n:'temperature',req:false,t:'number'}],response:{response:'Generated text',model:'llama2',done:true}},
    {name:'chat',method:'POST',path:'/api/chat',params:[{n:'model',req:true,t:'string'},{n:'message',req:true,t:'string'}],response:{message:{role:'assistant',content:'Response text'},done:true}},
    {name:'list_models',method:'GET',path:'/api/tags',params:[],response:{models:[{name:'llama2',size:3800000000}]}},
    {name:'pull_model',method:'POST',path:'/api/pull',params:[{n:'model',req:true,t:'string'}],response:{status:'success'}},
  ]},
  { slug:'vision-model', displayName:'Vision Model API', cat:'AI', icon:'eye', desc:'Analyze images using vision AI models.', tags:['vision','ai','image','analysis'], actions:[
    {name:'analyze_image',method:'POST',path:'/analyze',params:[{n:'imageUrl',req:true,t:'string'},{n:'prompt',req:false,t:'string'}],response:{description:'A cat sitting on a table',labels:['cat','table','indoor'],confidence:0.95}},
    {name:'detect_objects',method:'POST',path:'/detect',params:[{n:'imageUrl',req:true,t:'string'}],response:{objects:[{label:'cat',bbox:[10,20,100,200],confidence:0.92}]}},
    {name:'extract_text',method:'POST',path:'/ocr',params:[{n:'imageUrl',req:true,t:'string'},{n:'language',req:false,t:'string',def:'en'}],response:{text:'Extracted text content',blocks:[{text:'Block 1',confidence:0.98}]}},
    {name:'compare_images',method:'POST',path:'/compare',params:[{n:'imageUrl1',req:true,t:'string'},{n:'imageUrl2',req:true,t:'string'}],response:{similarity:0.85,differences:['color','position']}},
  ]},
  { slug:'minecraft-bot-controller', displayName:'Minecraft Bot Controller', cat:'Gaming', icon:'gamepad', desc:'Control Minecraft bots for building, mining, and exploring.', tags:['minecraft','bot','gaming','automation'], actions:[
    {name:'send_command',method:'POST',path:'/command',params:[{n:'command',req:true,t:'string'}],response:{status:'executed',message:'Command sent'}},
    {name:'get_status',method:'GET',path:'/status',params:[],response:{connected:true,position:{x:100,y:64,z:200},health:20}},
    {name:'navigate_to',method:'POST',path:'/navigate',params:[{n:'x',req:true,t:'string'},{n:'y',req:true,t:'string'},{n:'z',req:true,t:'string'}],response:{status:'navigating',eta:10}},
    {name:'get_inventory',method:'GET',path:'/inventory',params:[],response:{items:[{name:'diamond',count:5},{name:'iron_ingot',count:32}]}},
  ]},
  { slug:'seo-optimizer', displayName:'SEO Optimizer', cat:'Content', icon:'search', desc:'Analyze and optimize web pages for search engine rankings.', tags:['seo','search','optimization','web'], actions:[
    {name:'analyze_page',method:'POST',path:'/analyze',params:[{n:'url',req:true,t:'string'}],response:{score:72,issues:[{type:'missing_meta',severity:'high'}],title:'Page Title'}},
    {name:'check_keywords',method:'POST',path:'/keywords',params:[{n:'url',req:true,t:'string'},{n:'keywords',req:true,t:'string'}],response:{density:{keyword1:2.5,keyword2:1.2},suggestions:['related term']}},
    {name:'get_backlinks',method:'GET',pathTemplate:'/backlinks?url={url}',params:[{n:'url',req:true,t:'string'}],response:{totalLinks:150,links:[{source:'example.com',anchor:'click here'}]}},
    {name:'check_speed',method:'POST',path:'/speed',params:[{n:'url',req:true,t:'string'}],response:{loadTime:2.5,score:85,suggestions:['compress images']}},
  ]},
  { slug:'social-poster', displayName:'Social Poster', cat:'Social', icon:'share', desc:'Cross-post content to multiple social media platforms.', tags:['social','posting','cross-platform','content'], actions:[
    {name:'create_post',method:'POST',path:'/posts',params:[{n:'content',req:true,t:'string'},{n:'platforms',req:true,t:'string'},{n:'scheduleAt',req:false,t:'string'}],response:{postId:'p1',platforms:['twitter','linkedin'],status:'published'}},
    {name:'get_post',method:'GET',pathTemplate:'/posts/{postId}',params:[{n:'postId',req:true,t:'string'}],response:{postId:'p1',content:'Hello',status:'published',metrics:{likes:10}}},
    {name:'list_posts',method:'GET',pathTemplate:'/posts?limit={limit}',params:[{n:'limit',req:false,t:'number',def:10}],response:{posts:[{postId:'p1',content:'Hello'}]}},
    {name:'delete_post',method:'DELETE',pathTemplate:'/posts/{postId}',params:[{n:'postId',req:true,t:'string'}],response:{deleted:true}},
  ]},
  { slug:'prompt-generator', displayName:'Prompt Generator', cat:'AI', icon:'wand', desc:'Generate and optimize prompts for AI models.', tags:['prompt','ai','generation','optimization'], actions:[
    {name:'generate_prompt',method:'POST',path:'/generate',params:[{n:'task',req:true,t:'string'},{n:'model',req:false,t:'string',def:'gpt-4'},{n:'style',req:false,t:'string'}],response:{prompt:'Generated prompt text',tokens:150}},
    {name:'optimize_prompt',method:'POST',path:'/optimize',params:[{n:'prompt',req:true,t:'string'},{n:'goal',req:false,t:'string'}],response:{optimized:'Better prompt',improvements:['clarity','specificity']}},
    {name:'list_templates',method:'GET',path:'/templates',params:[],response:{templates:[{id:'t1',name:'Code Review',category:'engineering'}]}},
    {name:'evaluate_prompt',method:'POST',path:'/evaluate',params:[{n:'prompt',req:true,t:'string'}],response:{score:85,feedback:['Good specificity','Add constraints']}},
  ]},
  { slug:'test-generator', displayName:'Test Generator', cat:'DevOps', icon:'check-square', desc:'Automatically generate unit and integration tests for code.', tags:['testing','automation','code','devops'], actions:[
    {name:'generate_tests',method:'POST',path:'/generate',params:[{n:'code',req:true,t:'string'},{n:'framework',req:false,t:'string',def:'jest'},{n:'language',req:false,t:'string',def:'javascript'}],response:{tests:'test code here',testCount:5,coverage:85}},
    {name:'analyze_coverage',method:'POST',path:'/coverage',params:[{n:'code',req:true,t:'string'},{n:'tests',req:true,t:'string'}],response:{coverage:78,uncoveredLines:[10,15,22]}},
    {name:'suggest_cases',method:'POST',path:'/suggest',params:[{n:'code',req:true,t:'string'}],response:{cases:[{description:'edge case: empty input',priority:'high'}]}},
    {name:'validate_tests',method:'POST',path:'/validate',params:[{n:'tests',req:true,t:'string'}],response:{valid:true,issues:[],assertions:12}},
  ]},
  { slug:'log-monitor', displayName:'Log Monitor', cat:'DevOps', icon:'file-text', desc:'Monitor, search, and analyze application logs.', tags:['logs','monitoring','devops','analysis'], actions:[
    {name:'search_logs',method:'POST',path:'/search',params:[{n:'query',req:true,t:'string'},{n:'timeRange',req:false,t:'string',def:'1h'},{n:'limit',req:false,t:'number',def:100}],response:{logs:[{timestamp:'2024-01-01T00:00:00Z',level:'error',message:'Connection failed'}],total:1}},
    {name:'get_stats',method:'GET',pathTemplate:'/stats?timeRange={timeRange}',params:[{n:'timeRange',req:false,t:'string',def:'1h'}],response:{errorCount:5,warnCount:20,infoCount:500}},
    {name:'create_alert',method:'POST',path:'/alerts',params:[{n:'pattern',req:true,t:'string'},{n:'threshold',req:false,t:'number',def:1}],response:{alertId:'a1',pattern:'error',status:'active'}},
    {name:'list_alerts',method:'GET',path:'/alerts',params:[],response:{alerts:[{alertId:'a1',pattern:'error',triggered:false}]}},
  ]},
  { slug:'sql-analyzer', displayName:'SQL Analyzer', cat:'DevOps', icon:'database', desc:'Analyze, optimize, and explain SQL queries.', tags:['sql','database','analysis','optimization'], actions:[
    {name:'analyze_query',method:'POST',path:'/analyze',params:[{n:'query',req:true,t:'string'},{n:'dialect',req:false,t:'string',def:'postgresql'}],response:{complexity:'medium',suggestions:['Add index on column_a'],estimatedCost:150}},
    {name:'explain_query',method:'POST',path:'/explain',params:[{n:'query',req:true,t:'string'}],response:{plan:{type:'Seq Scan',cost:100,rows:1000},explanation:'Full table scan on users table'}},
    {name:'format_query',method:'POST',path:'/format',params:[{n:'query',req:true,t:'string'}],response:{formatted:'SELECT\n  id\nFROM users\nWHERE active = true;'}},
    {name:'validate_query',method:'POST',path:'/validate',params:[{n:'query',req:true,t:'string'}],response:{valid:true,errors:[],warnings:['Missing WHERE clause']}},
  ]},
  { slug:'i18n-tool', displayName:'i18n Tool', cat:'Content', icon:'globe', desc:'Manage internationalization keys, translations, and locale files.', tags:['i18n','localization','translation','content'], actions:[
    {name:'extract_keys',method:'POST',path:'/extract',params:[{n:'code',req:true,t:'string'},{n:'format',req:false,t:'string',def:'json'}],response:{keys:['welcome_message','error.not_found'],count:2}},
    {name:'translate_keys',method:'POST',path:'/translate',params:[{n:'keys',req:true,t:'string'},{n:'targetLang',req:true,t:'string'},{n:'sourceLang',req:false,t:'string',def:'en'}],response:{translations:{welcome_message:'Bienvenue'},targetLang:'fr'}},
    {name:'validate_locale',method:'POST',path:'/validate',params:[{n:'locale',req:true,t:'string'},{n:'reference',req:true,t:'string'}],response:{missing:['error.timeout'],extra:[],coverage:95}},
    {name:'merge_locales',method:'POST',path:'/merge',params:[{n:'base',req:true,t:'string'},{n:'override',req:true,t:'string'}],response:{merged:{welcome:'Hello'},conflicts:[]}},
  ]},
  { slug:'npm-audit-snyk', displayName:'NPM Audit / Snyk', cat:'DevOps', icon:'shield', desc:'Scan dependencies for security vulnerabilities via npm audit or Snyk.', tags:['npm','snyk','security','audit'], actions:[
    {name:'audit_deps',method:'POST',path:'/audit',params:[{n:'packageJson',req:true,t:'string'}],response:{vulnerabilities:[{name:'lodash',severity:'high',fixAvailable:true}],total:1}},
    {name:'get_advisories',method:'GET',pathTemplate:'/advisories?package={package}',params:[{n:'package',req:true,t:'string'}],response:{advisories:[{id:'GHSA-123',title:'Prototype Pollution',severity:'critical'}]}},
    {name:'check_license',method:'POST',path:'/license',params:[{n:'packageJson',req:true,t:'string'}],response:{issues:[{package:'gpl-lib',license:'GPL-3.0',severity:'warning'}]}},
    {name:'fix_vulnerabilities',method:'POST',path:'/fix',params:[{n:'packageJson',req:true,t:'string'},{n:'dryRun',req:false,t:'boolean',def:true}],response:{fixed:3,remaining:0,changes:[{package:'lodash',from:'4.17.20',to:'4.17.21'}]}},
  ]},
  { slug:'google-trends-api', displayName:'Google Trends API', cat:'Research', icon:'trending-up', desc:'Access Google Trends data for keyword research and trend analysis.', tags:['google','trends','seo','research'], actions:[
    {name:'get_interest',method:'GET',pathTemplate:'/interest?keyword={keyword}&geo={geo}&timeRange={timeRange}',params:[{n:'keyword',req:true,t:'string'},{n:'geo',req:false,t:'string',def:'US'},{n:'timeRange',req:false,t:'string',def:'today 12-m'}],response:{keyword:'AI',timeline:[{date:'2024-01',value:85}]}},
    {name:'get_related',method:'GET',pathTemplate:'/related?keyword={keyword}',params:[{n:'keyword',req:true,t:'string'}],response:{queries:[{query:'machine learning',value:100}],topics:[{title:'Deep Learning',value:90}]}},
    {name:'compare_keywords',method:'POST',path:'/compare',params:[{n:'keywords',req:true,t:'string'}],response:{comparison:[{keyword:'AI',avgInterest:85},{keyword:'ML',avgInterest:60}]}},
    {name:'get_trending',method:'GET',pathTemplate:'/trending?geo={geo}',params:[{n:'geo',req:false,t:'string',def:'US'}],response:{trending:[{title:'Breaking News',traffic:'500K+'}]}},
  ]},
  { slug:'video-downloader', displayName:'Video Downloader', cat:'Media', icon:'download-cloud', desc:'Download videos from supported platforms for processing.', tags:['video','download','media','extraction'], actions:[
    {name:'get_info',method:'POST',path:'/info',params:[{n:'url',req:true,t:'string'}],response:{title:'Video Title',duration:300,formats:[{quality:'720p',size:50000000}]}},
    {name:'download',method:'POST',path:'/download',params:[{n:'url',req:true,t:'string'},{n:'quality',req:false,t:'string',def:'720p'}],response:{taskId:'dl1',status:'downloading',progress:0}},
    {name:'get_status',method:'GET',pathTemplate:'/tasks/{taskId}',params:[{n:'taskId',req:true,t:'string'}],response:{taskId:'dl1',status:'completed',outputPath:'/downloads/video.mp4'}},
    {name:'extract_audio',method:'POST',path:'/extract-audio',params:[{n:'url',req:true,t:'string'},{n:'format',req:false,t:'string',def:'mp3'}],response:{taskId:'ea1',status:'processing'}},
  ]},
  { slug:'quora-zhihu-manager', displayName:'Quora/Zhihu Manager', cat:'Social', icon:'help-circle', desc:'Manage Q&A content on Quora and Zhihu platforms.', tags:['quora','zhihu','qa','social'], actions:[
    {name:'search_questions',method:'GET',pathTemplate:'/questions/search?query={query}&platform={platform}',params:[{n:'query',req:true,t:'string'},{n:'platform',req:false,t:'string',def:'quora'}],response:{questions:[{id:'q1',title:'What is AI?',followers:1000}]}},
    {name:'get_answers',method:'GET',pathTemplate:'/questions/{questionId}/answers',params:[{n:'questionId',req:true,t:'string'}],response:{answers:[{id:'a1',content:'AI is...',upvotes:50}]}},
    {name:'post_answer',method:'POST',pathTemplate:'/questions/{questionId}/answers',params:[{n:'questionId',req:true,t:'string'},{n:'content',req:true,t:'string'}],response:{answerId:'a2',status:'published'}},
    {name:'get_trending',method:'GET',pathTemplate:'/trending?platform={platform}',params:[{n:'platform',req:false,t:'string',def:'quora'}],response:{questions:[{id:'q1',title:'Trending Q',views:50000}]}},
  ]},
  { slug:'apple-health-parser', displayName:'Apple Health Parser', cat:'Data', icon:'heart', desc:'Parse and analyze Apple Health export data.', tags:['apple','health','fitness','data'], actions:[
    {name:'parse_export',method:'POST',path:'/parse',params:[{n:'filePath',req:true,t:'string'}],response:{recordCount:5000,dateRange:{start:'2023-01-01',end:'2024-01-01'}}},
    {name:'get_summary',method:'POST',path:'/summary',params:[{n:'filePath',req:true,t:'string'},{n:'metric',req:false,t:'string'}],response:{steps:{avg:8500,total:3102500},heartRate:{avg:72,min:55,max:150}}},
    {name:'get_workouts',method:'POST',path:'/workouts',params:[{n:'filePath',req:true,t:'string'},{n:'type',req:false,t:'string'}],response:{workouts:[{type:'Running',duration:1800,calories:300,date:'2024-01-01'}]}},
    {name:'export_csv',method:'POST',path:'/export-csv',params:[{n:'filePath',req:true,t:'string'},{n:'metric',req:true,t:'string'}],response:{outputPath:'/output/steps.csv',rows:365}},
  ]},
  { slug:'email-validator', displayName:'Email Validator', cat:'Content', icon:'at-sign', desc:'Validate email addresses and check deliverability.', tags:['email','validation','verification','deliverability'], actions:[
    {name:'validate_email',method:'POST',path:'/validate',params:[{n:'email',req:true,t:'string'}],response:{email:'test@example.com',valid:true,disposable:false,mxRecords:true}},
    {name:'bulk_validate',method:'POST',path:'/bulk',params:[{n:'emails',req:true,t:'string'}],response:{results:[{email:'a@b.com',valid:true}],validCount:1,invalidCount:0}},
    {name:'check_domain',method:'GET',pathTemplate:'/domain/{domain}',params:[{n:'domain',req:true,t:'string'}],response:{domain:'example.com',mxRecords:['mx1.example.com'],valid:true}},
    {name:'get_suggestions',method:'POST',path:'/suggest',params:[{n:'email',req:true,t:'string'}],response:{original:'test@gmial.com',suggestion:'test@gmail.com',confidence:0.95}},
  ]},
  { slug:'sentiment-analysis', displayName:'Sentiment Analysis', cat:'AI', icon:'smile', desc:'Analyze text sentiment, emotion, and tone.', tags:['sentiment','nlp','ai','analysis'], actions:[
    {name:'analyze_text',method:'POST',path:'/analyze',params:[{n:'text',req:true,t:'string'},{n:'language',req:false,t:'string',def:'en'}],response:{sentiment:'positive',score:0.85,emotions:{joy:0.7,anger:0.05}}},
    {name:'analyze_batch',method:'POST',path:'/batch',params:[{n:'texts',req:true,t:'string'}],response:{results:[{text:'Great!',sentiment:'positive',score:0.9}],avgScore:0.9}},
    {name:'detect_language',method:'POST',path:'/detect-lang',params:[{n:'text',req:true,t:'string'}],response:{language:'en',confidence:0.99,alternatives:[{language:'de',confidence:0.01}]}},
    {name:'extract_entities',method:'POST',path:'/entities',params:[{n:'text',req:true,t:'string'}],response:{entities:[{text:'Apple',type:'ORG',sentiment:'neutral'}]}},
  ]},
  { slug:'pdf-compare', displayName:'PDF Compare', cat:'Content', icon:'file-diff', desc:'Compare two PDF documents and highlight differences.', tags:['pdf','compare','diff','document'], actions:[
    {name:'compare_pdfs',method:'POST',path:'/compare',params:[{n:'file1',req:true,t:'string'},{n:'file2',req:true,t:'string'}],response:{identical:false,diffCount:5,pages:[{page:1,diffs:3}]}},
    {name:'get_text_diff',method:'POST',path:'/text-diff',params:[{n:'file1',req:true,t:'string'},{n:'file2',req:true,t:'string'}],response:{additions:['new text'],deletions:['old text'],changes:1}},
    {name:'get_visual_diff',method:'POST',path:'/visual-diff',params:[{n:'file1',req:true,t:'string'},{n:'file2',req:true,t:'string'},{n:'page',req:false,t:'number',def:1}],response:{diffImageUrl:'/output/diff-page1.png',changePercentage:12.5}},
    {name:'get_metadata_diff',method:'POST',path:'/metadata-diff',params:[{n:'file1',req:true,t:'string'},{n:'file2',req:true,t:'string'}],response:{diff:{author:['Author A','Author B'],pageCount:[10,12]}}},
  ]},
  { slug:'swagger-openapi-generator', displayName:'Swagger/OpenAPI Generator', cat:'DevOps', icon:'code', desc:'Generate API clients, documentation, and specs from OpenAPI definitions.', tags:['swagger','openapi','api','codegen'], actions:[
    {name:'generate_client',method:'POST',path:'/generate/client',params:[{n:'specUrl',req:true,t:'string'},{n:'language',req:false,t:'string',def:'javascript'}],response:{outputPath:'/output/client',files:['index.js','api.js']}},
    {name:'validate_spec',method:'POST',path:'/validate',params:[{n:'specUrl',req:true,t:'string'}],response:{valid:true,errors:[],warnings:['Missing description for /users']}},
    {name:'generate_docs',method:'POST',path:'/generate/docs',params:[{n:'specUrl',req:true,t:'string'},{n:'format',req:false,t:'string',def:'html'}],response:{outputPath:'/output/docs/index.html'}},
    {name:'convert_spec',method:'POST',path:'/convert',params:[{n:'specUrl',req:true,t:'string'},{n:'targetFormat',req:false,t:'string',def:'openapi3'}],response:{outputPath:'/output/spec.yaml',format:'openapi3'}},
  ]},
  { slug:'google-maps-api', displayName:'Google Maps API', cat:'Data', icon:'map', desc:'Geocode addresses, search places, and calculate routes via Google Maps.', tags:['google','maps','geocoding','places'], actions:[
    {name:'geocode',method:'GET',pathTemplate:'/geocode/json?address={address}',params:[{n:'address',req:true,t:'string'}],response:{results:[{formatted_address:'1600 Amphitheatre Pkwy',geometry:{location:{lat:37.422,lng:-122.084}}}]}},
    {name:'search_places',method:'GET',pathTemplate:'/place/textsearch/json?query={query}&radius={radius}',params:[{n:'query',req:true,t:'string'},{n:'radius',req:false,t:'number',def:5000}],response:{results:[{name:'Coffee Shop',place_id:'ChIJ123',rating:4.5}]}},
    {name:'get_directions',method:'GET',pathTemplate:'/directions/json?origin={origin}&destination={destination}&mode={mode}',params:[{n:'origin',req:true,t:'string'},{n:'destination',req:true,t:'string'},{n:'mode',req:false,t:'string',def:'driving'}],response:{routes:[{legs:[{distance:{text:'10 km'},duration:{text:'15 min'}}]}]}},
    {name:'get_place_details',method:'GET',pathTemplate:'/place/details/json?place_id={placeId}',params:[{n:'placeId',req:true,t:'string'}],response:{result:{name:'Coffee Shop',formatted_phone_number:'+1-234',opening_hours:{open_now:true}}}},
  ]},
];

// --- Reuse same templates as Batch 5 ---
function genHandler(s) {
  const actionNames = s.actions.map(a => `'${a.name}'`).join(', ');
  const validationCases = s.actions.map(a => { const rp = a.params.filter(p => p.req); if (!rp.length) return `    case '${a.name}': return { valid: true };`; const checks = rp.map(p => `      const v_${p.n} = validateNonEmptyString(params.${p.n}, '${p.n}');\n      if (!v_${p.n}.valid) return { valid: false, error: v_${p.n}.error };`).join('\n'); return `    case '${a.name}': {\n${checks}\n      return { valid: true };\n    }`; }).join('\n');
  const handlers = s.actions.map(a => { const fn = 'handle' + a.name.split('_').map(w => w[0].toUpperCase() + w.slice(1)).join(''); const rp = a.params.filter(p => p.req); const valBlock = rp.map(p => `  const v_${p.n} = validateNonEmptyString(params.${p.n}, '${p.n}');\n  if (!v_${p.n}.valid) return { result: \`Error: \${v_${p.n}.error}\`, metadata: { success: false, action: '${a.name}', error: 'INVALID_INPUT', timestamp: new Date().toISOString() } };`).join('\n'); let pathExpr; if (a.pathTemplate) { let t = a.pathTemplate; a.params.forEach(p => { if (t.includes(`{${p.n}}`)) t = t.replace(`{${p.n}}`, p.req ? `\${encodeURIComponent(v_${p.n}.value)}` : `\${encodeURIComponent(String(params.${p.n} ?? '${p.def??''}'))}`); }); pathExpr = `\`${t}\``; } else { pathExpr = `'${a.path}'`; } return `async function ${fn}(params, context) {\n${valBlock}\n  const resolved = getClient(context);\n  if (!resolved) return providerNotConfiguredError();\n  const timeoutMs = resolveTimeout(context);\n  try {\n    const data = await requestWithTimeout(resolved.client, '${a.method}', ${pathExpr}, {}, timeoutMs);\n    return { result: redactSensitive(JSON.stringify(data, null, 2)), metadata: { success: true, action: '${a.name}', timestamp: new Date().toISOString() } };\n  } catch (err) {\n    return { result: redactSensitive(\`Error: \${err.message}\`), metadata: { success: false, action: '${a.name}', error: err.code || 'UPSTREAM_ERROR', timestamp: new Date().toISOString() } };\n  }\n}`; }).join('\n\n');
  const switchCases = s.actions.map(a => { const fn = 'handle' + a.name.split('_').map(w => w[0].toUpperCase() + w.slice(1)).join(''); return `      case '${a.name}': return await ${fn}(params, context);`; }).join('\n');
  return `/**\n * ${s.displayName} Skill Handler (Layer 1)\n * ${s.desc}\n */\n\nconst VALID_ACTIONS = [${actionNames}];\nconst DEFAULT_TIMEOUT_MS = 30000;\nconst MAX_TIMEOUT_MS = 120000;\nfunction getClient(context) { if (context?.providerClient) return { client: context.providerClient, type: 'provider' }; if (context?.gatewayClient) return { client: context.gatewayClient, type: 'gateway' }; return null; }\nfunction providerNotConfiguredError() { return { result: 'Error: Provider client required for ${s.displayName} access.', metadata: { success: false, error: { code: 'PROVIDER_NOT_CONFIGURED', message: 'Provider client required.', retriable: false } } }; }\nfunction resolveTimeout(context) { const c = context?.config?.timeoutMs; if (typeof c === 'number' && c > 0) return Math.min(c, MAX_TIMEOUT_MS); return DEFAULT_TIMEOUT_MS; }\nasync function requestWithTimeout(client, method, path, opts, timeoutMs) { const controller = new AbortController(); const timer = setTimeout(() => controller.abort(), timeoutMs); try { const r = await client.request(method, path, null, { ...opts, signal: controller.signal }); clearTimeout(timer); return r; } catch (err) { clearTimeout(timer); if (err.name === 'AbortError') throw { code: 'TIMEOUT', message: \`Request timed out after \${timeoutMs}ms.\` }; throw { code: 'UPSTREAM_ERROR', message: err.message || 'Unknown upstream error' }; } }\nconst SENSITIVE_PATTERNS = [/(?:api[_-]?key|token|secret|password|authorization|bearer)\\s*[:=]\\s*\\S+/gi];\nfunction redactSensitive(text) { if (typeof text !== 'string') return text; let c = text; for (const p of SENSITIVE_PATTERNS) c = c.replace(p, '[REDACTED]'); return c; }\nfunction validateNonEmptyString(value, fieldName) { if (!value || typeof value !== 'string') return { valid: false, error: \`The "\${fieldName}" parameter is required and must be a non-empty string.\` }; const t = value.trim(); if (!t.length) return { valid: false, error: \`The "\${fieldName}" parameter must not be empty.\` }; return { valid: true, value: t }; }\n\nexport function validate(params) { const { action } = params || {}; if (!action || !VALID_ACTIONS.includes(action)) return { valid: false, error: \`Invalid action "\${action}". Must be one of: \${VALID_ACTIONS.join(', ')}\` }; switch (action) {\n${validationCases}\n    default: return { valid: false, error: \`Unknown.\` };\n  }\n}\n\n${handlers}\n\nexport async function execute(params, context) { const { action } = params || {}; if (!action || !VALID_ACTIONS.includes(action)) return { result: \`Error: Invalid action "\${action}". Must be one of: \${VALID_ACTIONS.join(', ')}\`, metadata: { success: false, action: action || null, error: 'INVALID_ACTION', timestamp: new Date().toISOString() } }; try { switch (action) {\n${switchCases}\n      default: return { result: 'Error: Unknown action.', metadata: { success: false, action, error: 'INVALID_ACTION', timestamp: new Date().toISOString() } };\n    } } catch (error) { return { result: redactSensitive(\`Error: \${error.message}\`), metadata: { success: false, action, error: 'UPSTREAM_ERROR', timestamp: new Date().toISOString() } }; }\n}\n\nexport const meta = { name: '${s.slug}', version: '1.0.0', description: '${s.desc}', actions: VALID_ACTIONS };\nexport { getClient, providerNotConfiguredError, resolveTimeout, requestWithTimeout, redactSensitive, validateNonEmptyString, VALID_ACTIONS, DEFAULT_TIMEOUT_MS, MAX_TIMEOUT_MS };\n`;
}
function genSkillJson(s) { return JSON.stringify({name:s.slug,version:'1.0.0',displayName:s.displayName,description:s.desc,category:s.cat,icon:s.icon,author:'claw2agent',layer:'L1',requiresApiKey:true,tags:s.tags,verified:true,tier:'pro',implemented:true,config:{provider:'providerClient',timeoutMs:30000,maxTimeoutMs:120000},toolDefinition:{name:s.slug.replace(/-/g,'_'),description:s.desc,parameters:{type:'object',properties:{action:{type:'string',enum:s.actions.map(a=>a.name)}},required:['action']}}},null,2)+'\n'; }
function genTest(s) { const sampleLines = s.actions.map(a => `const sample_${a.name} = ${JSON.stringify(a.response)};`).join('\n'); const provTests = s.actions.map(a => { const ps = a.params.filter(p=>p.req).map(p=>`${p.n}:'test'`).join(','); return `  it('fail ${a.name}', async()=>{ const r=await execute({action:'${a.name}'${ps?','+ps:''}},{}); assert.equal(r.metadata.success,false); assert.equal(r.metadata.error.code,'PROVIDER_NOT_CONFIGURED'); });`; }).join('\n'); const actionTests = s.actions.map(a => { const rp=a.params.filter(p=>p.req); const ps=rp.map(p=>`${p.n}:'test'`).join(','); let t=[`  it('${a.name} ok', async()=>{ const r=await execute({action:'${a.name}'${ps?','+ps:''}},mockContext(sample_${a.name})); assert.equal(r.metadata.success,true); assert.equal(r.metadata.action,'${a.name}'); });`]; if(rp.length){t.push(`  it('${a.name} missing', async()=>{ const r=await execute({action:'${a.name}'},mockContext(sample_${a.name})); assert.equal(r.metadata.success,false); assert.equal(r.metadata.error,'INVALID_INPUT'); });`);t.push(`  it('${a.name} non-str', async()=>{ const r=await execute({action:'${a.name}',${rp[0].n}:123},mockContext(sample_${a.name})); assert.equal(r.metadata.success,false); });`);} return `describe('${s.slug}: ${a.name}', ()=>{beforeEach(()=>{});\n${t.join('\n')}\n});`; }).join('\n'); const toTests = s.actions.map(a => { const ps=a.params.filter(p=>p.req).map(p=>`${p.n}:'test'`).join(','); return `  it('to ${a.name}', async()=>{ const r=await execute({action:'${a.name}'${ps?','+ps:''}},mockContextTimeout()); assert.equal(r.metadata.success,false); assert.equal(r.metadata.error,'TIMEOUT'); });`; }).join('\n'); const fp=s.actions[0]; const fps=fp.params.filter(p=>p.req).map(p=>`${p.n}:'test'`).join(','); const pathTests = s.actions.map(a => { const ps=a.params.filter(p=>p.req).map(p=>`${p.n}:'test'`).join(','); return `  it('path ${a.name}', async()=>{ let p=null; const ctx={providerClient:{request:async(m,pa)=>{p=pa;return sample_${a.name};}},config:{timeoutMs:5000}}; await execute({action:'${a.name}'${ps?','+ps:''}},ctx); assert.ok(p!==null); });`; }).join('\n'); const valTests = s.actions.map(a => { const rp=a.params.filter(p=>p.req); if(!rp.length) return `  it('${a.name} ok', ()=>{ assert.equal(validate({action:'${a.name}'}).valid,true); });`; const ps=rp.map(p=>`${p.n}:'t'`).join(','); return `  it('${a.name} req', ()=>{ assert.equal(validate({action:'${a.name}'}).valid,false); assert.equal(validate({action:'${a.name}',${ps}}).valid,true); });`; }).join('\n');
  return `import assert from 'node:assert/strict';\nimport { describe, it, beforeEach } from 'node:test';\nimport { execute, validate, meta, getClient, providerNotConfiguredError, resolveTimeout, requestWithTimeout, redactSensitive, validateNonEmptyString, VALID_ACTIONS, DEFAULT_TIMEOUT_MS, MAX_TIMEOUT_MS } from '../handler.js';\nfunction mockContext(r,c){ return {providerClient:{request:async()=>r},config:c||{timeoutMs:5000}}; }\nfunction mockContextError(e){ return {providerClient:{request:async()=>{throw e;}},config:{timeoutMs:1000}}; }\nfunction mockContextTimeout(){ return {providerClient:{request:async()=>{const e=new Error('aborted');e.name='AbortError';throw e;}},config:{timeoutMs:100}}; }\n${sampleLines}\ndescribe('${s.slug}: action validation', ()=>{beforeEach(()=>{});\n  it('reject invalid', async()=>{const r=await execute({action:'invalid'},{}); assert.equal(r.metadata.success,false); assert.equal(r.metadata.error,'INVALID_ACTION');});\n  it('reject missing', async()=>{const r=await execute({},{}); assert.equal(r.metadata.success,false);});\n  it('reject null', async()=>{const r=await execute(null,{}); assert.equal(r.metadata.success,false);});\n  it('reject undef', async()=>{const r=await execute(undefined,{}); assert.equal(r.metadata.success,false);});\n  it('list actions', async()=>{const r=await execute({action:'bad'},{}); for(const a of VALID_ACTIONS) assert.ok(r.result.includes(a));});\n});\ndescribe('${s.slug}: PROVIDER_NOT_CONFIGURED', ()=>{beforeEach(()=>{});\n${provTests}\n});\n${actionTests}\ndescribe('${s.slug}: timeout', ()=>{beforeEach(()=>{});\n${toTests}\n});\ndescribe('${s.slug}: network errors', ()=>{beforeEach(()=>{});\n  it('UPSTREAM_ERROR', async()=>{const r=await execute({action:'${fp.name}'${fps?','+fps:''}},mockContextError(new Error('fail'))); assert.equal(r.metadata.success,false); assert.equal(r.metadata.error,'UPSTREAM_ERROR');});\n  it('include msg', async()=>{const r=await execute({action:'${fp.name}'${fps?','+fps:''}},mockContextError(new Error('fail'))); assert.ok(r.result.includes('fail'));});\n});\ndescribe('${s.slug}: getClient', ()=>{beforeEach(()=>{});\n  it('prefer provider', ()=>{assert.equal(getClient({providerClient:{request:()=>{}},gatewayClient:{request:()=>{}}}).type,'provider');});\n  it('fallback', ()=>{assert.equal(getClient({gatewayClient:{request:()=>{}}}).type,'gateway');});\n  it('null', ()=>{assert.equal(getClient({}),null);});\n  it('null undef', ()=>{assert.equal(getClient(undefined),null);});\n});\ndescribe('${s.slug}: redactSensitive', ()=>{beforeEach(()=>{});\n  it('redact', ()=>{assert.ok(redactSensitive('api_key: test_key_val').includes('[REDACTED]'));});\n  it('clean', ()=>{assert.equal(redactSensitive('clean'),'clean');});\n  it('non-str', ()=>{assert.equal(redactSensitive(42),42);});\n});\ndescribe('${s.slug}: resolveTimeout', ()=>{beforeEach(()=>{});\n  it('def', ()=>{assert.equal(resolveTimeout({}),DEFAULT_TIMEOUT_MS);});\n  it('undef', ()=>{assert.equal(resolveTimeout(undefined),DEFAULT_TIMEOUT_MS);});\n  it('custom', ()=>{assert.equal(resolveTimeout({config:{timeoutMs:60000}}),60000);});\n  it('cap', ()=>{assert.equal(resolveTimeout({config:{timeoutMs:999999}}),MAX_TIMEOUT_MS);});\n  it('D=30000', ()=>{assert.equal(DEFAULT_TIMEOUT_MS,30000);});\n  it('M=120000', ()=>{assert.equal(MAX_TIMEOUT_MS,120000);});\n});\ndescribe('${s.slug}: validate()', ()=>{beforeEach(()=>{});\n  it('reject invalid', ()=>{assert.equal(validate({action:'bad'}).valid,false);});\n  it('reject null', ()=>{assert.equal(validate(null).valid,false);});\n${valTests}\n});\ndescribe('${s.slug}: meta', ()=>{beforeEach(()=>{});\n  it('name', ()=>{assert.equal(meta.name,'${s.slug}');});\n  it('version', ()=>{assert.equal(meta.version,'1.0.0');});\n  it('actions', ()=>{assert.equal(meta.actions.length,${s.actions.length});});\n});\ndescribe('${s.slug}: gateway', ()=>{beforeEach(()=>{});\n  it('use gateway', async()=>{const ctx={gatewayClient:{request:async()=>sample_${fp.name}},config:{timeoutMs:5000}};const r=await execute({action:'${fp.name}'${fps?','+fps:''}},ctx);assert.equal(r.metadata.success,true);});\n});\ndescribe('${s.slug}: providerNotConfiguredError', ()=>{beforeEach(()=>{});\n  it('false', ()=>{assert.equal(providerNotConfiguredError().metadata.success,false);});\n  it('code', ()=>{assert.equal(providerNotConfiguredError().metadata.error.code,'PROVIDER_NOT_CONFIGURED');});\n});\ndescribe('${s.slug}: constants', ()=>{beforeEach(()=>{});\n  it('VALID_ACTIONS', ()=>{assert.deepEqual(VALID_ACTIONS,[${s.actions.map(a=>`'${a.name}'`).join(',')}]);});\n});\ndescribe('${s.slug}: paths', ()=>{beforeEach(()=>{});\n${pathTests}\n});\n`; }
function genReadme(s) { return `# ${s.displayName} [L1]\n\n${s.desc}\n\n## Actions\n\n${s.actions.map(a=>`### \`${a.name}\`\n${a.params.length?`| Param | Req | Type |\n|-------|-----|------|\n${a.params.map(p=>`| ${p.n} | ${p.req?'✅':'❌'} | ${p.t} |`).join('\n')}`:'_No required parameters._'}`).join('\n\n')}\n\n## Testing\n\n\`\`\`bash\nnode --test skills/${s.slug}/__tests__/handler.test.js\n\`\`\`\n`; }

for (const spec of SKILLS) {
  const base = `skills/${spec.slug}`;
  mkdirSync(`${base}/__tests__`, { recursive: true });
  try { writeFileSync(`${base}/package.json`, '{ "type": "module" }\n', { flag: 'wx' }); } catch {}
  writeFileSync(`${base}/handler.js`, genHandler(spec));
  writeFileSync(`${base}/skill.json`, genSkillJson(spec));
  writeFileSync(`${base}/__tests__/handler.test.js`, genTest(spec));
  writeFileSync(`${base}/README.md`, genReadme(spec));
  console.log(`✅ ${spec.slug} (${spec.actions.length} actions)`);
}
console.log(`\nBatch 6: ${SKILLS.length} skills generated.`);
